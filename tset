pipeline {
    agent any
    
    stages{
        stage("Git Checkout"){
            steps{
                git branch: 'main', credentialsId: 'e46bb6cc-6f09-4f00-a546-1c60f2920427', url: 'https://github.com/surya-devopsaws/index.git'
            }
        }

stage('Get Approvel') {
    steps {
        script {
            def userInput = input(
                message: 'Do you want to proceed this Deployment?',
                submitterParameter: 'APPROVER',
                ok: 'Yes',
                parameters: [
                    booleanParam(defaultValue: false, description: 'Approve deployment', name: 'APPROVE_DEPLOYMENT')
                ]
            )
            def approver = userInput['APPROVER']
            if (approver.toLowerCase() == 'Vinoth') {
                echo 'Approved by Vinoth'
            } else {
                error "Approval not granted by vinoth. Only 'vinoth' is authorized to approve."
            }
        }
    }
}

        

            stage('Deploy') {
                steps {
                    // Deploy your application using sshPublisher
                    sshPublisher(publishers: [sshPublisherDesc(
                        configName: 'Jenkins',
                        transfers: [sshTransfer(
                            cleanRemote: false,
                            excludes: '',
                            execCommand: '',
                            flatten: false,
                            makeEmptyDirs: false,
                            noDefaultExcludes: false,
                            patternSeparator: '[, ]+',
                            remoteDirectory: '/',
                            remoteDirectorySDF: false,
                            removePrefix: '',
                            sourceFiles: '*/**'
                        )],
                        usePromotionTimestamp: false,
                        useWorkspaceInPromotion: false,
                        verbose: false
                    )])
                }
            }
          
       
    }
}        
